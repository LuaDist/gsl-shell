
# -- refers to abs, min, max, pow

local function rescale_error (err, result_abs, result_asc)
   err = abs(err)

   if result_asc ~= 0 and err ~= 0 then
      local scale = pow((200 * err / result_asc), 1.5)
      scale = min(scale, 1)
      err = result_asc * scale
   end

   if result_abs > 2.2250738585072e-308 / (50 * 2.2204460492503e-16) then
      local min_err = 50 * 2.2204460492503e-16 * result_abs
      err = max(err, min_err)
   end
   
   return err
end
